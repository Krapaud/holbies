<!DOCTYPE html>
<html>
<head>
    <title>Diagnostic JavaScript PLD</title>
    <style>
        body { padding: 20px; font-family: monospace; background: #f5f5f5; }
        .console { background: #000; color: #0f0; padding: 15px; border-radius: 5px; height: 300px; overflow-y: auto; }
        button { padding: 10px 15px; margin: 5px; background: #007acc; color: white; border: none; border-radius: 3px; cursor: pointer; }
        .error { color: #f44; }
        .success { color: #4f4; }
        .warning { color: #fa0; }
        .info { color: #4af; }
    </style>
</head>
<body>
    <h1>ğŸ” Diagnostic JavaScript PLD</h1>
    
    <div>
        <button onclick="testPldJs()">Test pld.js</button>
        <button onclick="testAIQuizManager()">Test AIQuizManager</button>
        <button onclick="openPld()">Ouvrir PLD</button>
        <button onclick="clearConsole()">Clear</button>
    </div>
    
    <div class="console" id="console"></div>
    
    <script>
        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const line = document.createElement('div');
            line.className = type;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
        }
        
        function clearConsole() {
            document.getElementById('console').innerHTML = '';
        }
        
        function testPldJs() {
            log('ğŸ§ª Test de chargement pld.js...', 'info');
            
            fetch('http://localhost:8000/static/js/pld.js')
                .then(response => {
                    if (response.ok) {
                        log('âœ… pld.js accessible', 'success');
                        return response.text();
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                })
                .then(content => {
                    // VÃ©rifications de base
                    const hasClass = content.includes('class AIQuizManager');
                    const hasTry = content.match(/try\s*{/g);
                    const hasCatch = content.match(/}\s*catch/g);
                    
                    log(`Class AIQuizManager: ${hasClass ? 'âœ…' : 'âŒ'}`, hasClass ? 'success' : 'error');
                    log(`Try blocks: ${hasTry ? hasTry.length : 0}`, 'info');
                    log(`Catch blocks: ${hasCatch ? hasCatch.length : 0}`, 'info');
                    
                    if (hasTry && hasCatch && hasTry.length === hasCatch.length) {
                        log('âœ… Try/catch Ã©quilibrÃ©s', 'success');
                    } else {
                        log('âŒ Try/catch dÃ©sÃ©quilibrÃ©s', 'error');
                    }
                    
                    // Essayer de charger le script
                    const script = document.createElement('script');
                    script.src = 'http://localhost:8000/static/js/pld.js';
                    script.onload = () => {
                        log('âœ… Script pld.js chargÃ©', 'success');
                        testAIQuizManager();
                    };
                    script.onerror = (error) => {
                        log('âŒ Erreur chargement script', 'error');
                        log(`DÃ©tails: ${error.message || 'Erreur inconnue'}`, 'error');
                    };
                    document.head.appendChild(script);
                })
                .catch(error => {
                    log(`âŒ Erreur: ${error.message}`, 'error');
                });
        }
        
        function testAIQuizManager() {
            log('ğŸ§ª Test AIQuizManager...', 'info');
            
            setTimeout(() => {
                if (typeof AIQuizManager !== 'undefined') {
                    log('âœ… Classe AIQuizManager disponible', 'success');
                    
                    try {
                        // Charger aussi les dÃ©pendances nÃ©cessaires
                        if (typeof HolbiesApp === 'undefined') {
                            log('âš ï¸ HolbiesApp non disponible, simulation...', 'warning');
                            window.HolbiesApp = class { constructor() {} };
                        }
                        
                        if (!window.holbiesApp) {
                            window.holbiesApp = new HolbiesApp();
                            log('âœ… holbiesApp crÃ©Ã©', 'success');
                        }
                        
                        const manager = new AIQuizManager();
                        log('âœ… Instance AIQuizManager crÃ©Ã©e', 'success');
                        
                        if (typeof manager.selectCategorySidebar === 'function') {
                            log('âœ… MÃ©thode selectCategorySidebar disponible', 'success');
                        } else {
                            log('âŒ MÃ©thode selectCategorySidebar manquante', 'error');
                        }
                        
                    } catch (error) {
                        log(`âŒ Erreur crÃ©ation instance: ${error.message}`, 'error');
                        log(`Stack: ${error.stack}`, 'error');
                    }
                } else {
                    log('âŒ Classe AIQuizManager non disponible', 'error');
                    log(`Types disponibles: ${Object.getOwnPropertyNames(window).filter(n => n.includes('Quiz')).join(', ')}`, 'info');
                }
            }, 100);
        }
        
        function openPld() {
            log('ğŸš€ Ouverture PLD...', 'info');
            window.open('http://localhost:8000/pld', 'pld', 'width=1200,height=800');
        }
        
        // Auto-start
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ Diagnostic JavaScript PLD dÃ©marrÃ©', 'info');
            log('ğŸ’¡ Cliquez sur "Test pld.js" pour commencer', 'info');
        });
        
        // Capturer les erreurs JavaScript globales
        window.onerror = function(message, source, lineno, colno, error) {
            log(`âŒ Erreur JS globale: ${message}`, 'error');
            log(`ğŸ“ Source: ${source}:${lineno}:${colno}`, 'error');
            if (error && error.stack) {
                log(`ğŸ“‹ Stack: ${error.stack}`, 'error');
            }
        };
        
        window.addEventListener('unhandledrejection', function(event) {
            log(`âŒ Promise rejetÃ©e: ${event.reason}`, 'error');
        });
    </script>
</body>
</html>
